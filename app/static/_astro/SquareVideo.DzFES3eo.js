import{u,a,i as g,l as x,A as f,t as w}from"./jsxRuntime.module.B0WncZav.js";import{h as p,y as v}from"./hooks.module.CncNDo9D.js";import{k}from"./preact.module.CuoaqbJH.js";const r={socket:void 0,interval:void 0},I=async i=>{const c=document.getElementById("video"),e=x(f,{transports:["websocket"]});r.socket=e,e.on("connect",()=>{console.log("Connected to server"),i(e.id)}),e.on("disconnect",()=>{console.log("Disconnected from server")}),e.on("messages",n=>{console.log(n)}),navigator.mediaDevices.getUserMedia({video:!0}).then(n=>{c.srcObject=n,c.play();const t=document.createElement("canvas");t.width=500,t.height=500;const d=t.getContext("2d"),m=setInterval(()=>{d?.drawImage(c,0,0,t.width,t.height);const l=t.toDataURL("image/jpeg");e.emit("frame",l)},100);e.on("new-frame",({data:l})=>{const o=document.getElementById("canvass");if(o&&o?.getContext){const h=o.getContext("2d"),s=new Image;s.onload=function(){o.height=s.height,o.width=s.width,h?.drawImage(s,0,0)},s.src="data:image/jpeg;base64,"+l}}),r.interval=m}).catch(n=>{console.error("Error accessing the camera: ",n)})},j=()=>{const[i,c]=p(null),e=u(g),n=d=>c(d),t=()=>{if(!r.socket)return;c(null),w(),g.set(!1),r.socket.disconnect(),clearInterval(r.interval),document.getElementById("video").srcObject.getTracks().forEach(s=>s.stop());const o=document.getElementById("canvass");o.getContext("2d")?.clearRect(0,0,o.width,o.height)};return v(()=>{e&&I(n)},[e]),v(()=>()=>{t()},[]),e&&a(k,{children:[i&&a("h2",{className:"mt-5 text-center text-xl font-light",children:["Id: ",i]}),a("div",{className:"sm:container-sm flex items-center justify-center pt-2 sm:mx-auto",children:[a("video",{id:"video",width:"640",height:"480",autoplay:!0,className:"rounded-lg",hidden:!0}),a("canvas",{id:"canvass",width:"500",height:"500",className:"h-full w-80 rounded-lg md:w-96 xl:w-96"})]}),i&&a("button",{className:"font-extra-light mt-5 rounded bg-red-500 px-4 py-2 text-white hover:bg-red-700",onClick:t,children:"Desconectar"})]})};export{j as SquareVideo};
